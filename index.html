<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friend Calling</title>
    <script src='https://meet.jit.si/external_api.js'></script>
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #121212; color: white; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* –¶–µ–Ω—Ç—Ä–æ–≤–∫–∞ —ç–∫—Ä–∞–Ω–æ–≤ */
        .screen { display: none; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .active { display: flex; }

        /* –°—Ç–∏–ª—å –∏–Ω–ø—É—Ç–æ–≤ –∏ –∫–Ω–æ–ø–æ–∫ */
        input { padding: 15px; font-size: 18px; border-radius: 12px; border: 2px solid #333; text-align: center; width: 80%; max-width: 300px; margin-bottom: 20px; background: #222; color: white; outline: none; }
        button { padding: 15px 40px; font-size: 18px; border-radius: 30px; border: none; cursor: pointer; background: #007bff; color: white; font-weight: bold; transition: 0.3s; }
        button:hover { background: #0056b3; }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–µ–æ */
        #meet { flex: 1; width: 100%; height: 100%; background: black; }
    </style>
</head>
<body>

    <div id="login-screen" class="screen active">
        <h1>üîí –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
        <p>–ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫</p>
        
        <script async src="https://telegram.org/js/telegram-widget.js?22" 
                data-telegram-login="FriendCalling_bot" 
                data-size="large" 
                data-radius="10" 
                data-onauth="onTelegramAuth(user)" 
                data-request-access="write"></script>
    </div>

    <div id="lobby-screen" class="screen">
        <h1 id="welcome-msg">–ü—Ä–∏–≤–µ—Ç!</h1>
        <input type="text" id="room-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã" onkeypress="handleEnter(event)">
        <button onclick="enterRoom()">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
    </div>

    <div id="call-screen" style="display:none; width: 100%; height: 100%;">
        <div id="meet"></div>
    </div>

    <script>
        let currentUser = null;
        const JITSI_DOMAIN = 'meet.ffmuc.net'; // –¢–≤–æ–π —Å–µ—Ä–≤–µ—Ä

        // 1. –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –≤—ã–∑—ã–≤–∞–µ—Ç –¢–µ–ª–µ–≥—Ä–∞–º –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –≤—Ö–æ–¥–µ
        function onTelegramAuth(user) {
            currentUser = user;
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('lobby-screen').classList.add('active');
            document.getElementById('welcome-msg').innerText = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}!`;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
        function handleEnter(e) { if (e.key === "Enter") enterRoom(); }

        // 2. –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∑–≤–æ–Ω–∫—É
        function enterRoom() {
            const roomName = document.getElementById('room-input').value.trim();
            if (!roomName) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã!");

            document.getElementById('lobby-screen').classList.remove('active');
            document.getElementById('call-screen').style.display = 'block';

            // –ó–∞–ø—É—Å–∫–∞–µ–º Jitsi
            const options = {
                roomName: 'MyFriendCall_' + roomName, // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å
                width: '100%',
                height: '100%',
                parentNode: document.querySelector('#meet'),
                lang: 'ru',
                userInfo: {
                    displayName: currentUser ? currentUser.first_name : '–ì–æ—Å—Ç—å'
                },
                configOverwrite: {
                    startWithAudioMuted: false,
                    prejoinPageEnabled: false 
                }
            };

            const api = new JitsiMeetExternalAPI(JITSI_DOMAIN, options);

            api.addEventListeners({
                videoConferenceLeft: function () { location.reload(); }
            });
        }
    </script>
</body>
</html>
